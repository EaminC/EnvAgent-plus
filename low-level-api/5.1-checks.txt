========================================================
CHECKS.txt
========================================================

Purpose:
    - Ensure the launched bare-metal node is healthy, reachable, and consistent with the reservation.
    - Give the LLM a minimal but complete checklist to validate a node before telling the user it is ready.
    - Let the LLM detect common provisioning failures (boot errors, wrong host assigned, missing GPU, wrong RAM, etc.).

What the agent actually needs:
    - Check ACTIVE state and private IP.
    - Confirm reservation_id matches the node that was launched.
    - Verify hardware (CPU, RAM, GPU) matches host show.
    - Verify OS matches the image used in the launch.
    - Confirm network and DNS are functional.
    - Report any mismatches or suspicious values immediately.

What can be trimmed (optional):
    - Optional firewall checks and service checks may be skipped unless the user explicitly asks.
    - MTU check may be optional unless the user reports networking issues.



========================================================
1. Check basic node reachability
========================================================

1.1 Verify that the instance boots and becomes ACTIVE
    Required command:
        openstack server show <SERVER_ID>
    Conditions:
        status should be ACTIVE
        vm_state should not be error
        task_state should be None

1.2 Verify private IP is assigned
    Required field:
        addresses should include an internal IP from sharednet1

1.3 If floating IP assigned
        Verify that ping works and SSH responds
        Example:
            ping -c 2 <FLOATING_IP>
            ssh -o StrictHostKeyChecking=no ubuntu@<FLOATING_IP> hostname

If these checks fail, the agent must report a connectivity failure.


========================================================
2. Check reservation correctness
========================================================

2.1 Confirm that the reservation used in launch matches the node
    From:
        openstack reservation lease show <LEASE_ID>

    The following must match:
        reservations[*].id == the reservation ID passed in
        reservations[*].resource_type contains physical:host
        reservations[*].resource_id equals the physical host ID of the running node

2.2 Verify the lease status is ACTIVE


========================================================
3. Check CPU information
========================================================

3.1 Verify CPU count
    From inside the node:
        nproc
    Compare with expected vcpus from:
        openstack reservation host show <HOST_ID>

3.2 Verify CPU model
    Inside:
        lscpu
    Node must match the advertised model in host show

3.3 Verify number of sockets and cores per socket:
        lscpu | grep -i socket
        lscpu | grep -i core
    

========================================================
4. Check memory information
========================================================

4.1 Verify available RAM
    Inside:
        free -h
        cat /proc/meminfo
    Compare with main_memory.humanized_ram_size in host show

4.2 Confirm that swap is disabled (expected on bare metal)


========================================================
5. Check GPU information
========================================================

If the node type includes a GPU (for example gpu_rtx_6000):

5.1 Validate that GPU is visible:
        nvidia-smi

5.2 Validate GPU count:
        nvidia-smi -L
    Must match gpu.gpu_count in host show

5.3 Validate GPU model:
    Must match gpu.gpu_model in host show


========================================================
6. Check storage devices
========================================================

6.1 Validate available disk:
        lsblk
        df -h /

6.2 Compare against storage_devices fields in:
        openstack reservation host show <HOST_ID>

6.3 Ensure that root filesystem mounted correctly


========================================================
7. Check network health
========================================================

7.1 Verify internal connectivity
        ping -c 2 8.8.8.8

7.2 Verify DNS
        dig google.com
        or:
        ping google.com

7.3 Verify that the MTU is what the network expects
        ip link show eno1 | grep mtu


========================================================
8. Check OS information
========================================================

8.1 Confirm image identity
    Inside node:
        cat /etc/os-release
    Compare NAME and VERSION with the selected image
    Example:
        CC-Ubuntu20.04 should match Ubuntu 20.04

8.2 Check kernel version:
        uname -a


========================================================
9. Check system services
========================================================

9.1 Verify collectd is disabled if user requested to disable:
        systemctl status collectd

9.2 Verify cloud-init completed:
        systemctl status cloud-init


========================================================
10. Optional security checks
========================================================

10.1 Verify firewall rules:
        sudo firewall-cmd --zone=public --list-services

10.2 Verify SSH allows only key-based login, not passwords


========================================================
11. Cleanup readiness checks
========================================================

11.1 Confirm if the machine can be safely deleted
        openstack server show <SERVER_ID>
        Ensure no attached floating IP that is still needed

11.2 Confirm lease end schedule is correct


========================================================
12. Final instruction to the LLM
========================================================

After performing all checks above, the agent must scan the results 
and determine whether any important validation checks are missing. 
The agent must propose additional checks if needed. The agent 
should also warn if:

- a value looks suspicious
- host metadata does not match reported hardware
- network behavior is inconsistent
- BIOS, CPU, RAM, or GPU values look incorrect
- cloud-init or system services failed
- the node appears unhealthy in any way

The agent must never assume that a node is healthy unless all checks pass.

