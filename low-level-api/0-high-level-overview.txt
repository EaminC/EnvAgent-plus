# High-Level Bare-Metal Workflow (Master Overview)

This overview explains the correct sequence for launching a bare-metal node
through Chameleon. Each part has its own .txt file with detailed commands.
This file describes what to do, when to do it, and which file to read for
deeper instructions.

====================================================
Part 0. Repo Setup and Authentication
====================================================

Goal:
Make sure the environment is ready before touching hardware or reservations.

Relevant file:
1.1-download-repo.txt

Steps:
1. Confirm the EnvAgent-plus repo is present and updated.
2. Confirm Python dependencies are installed.
3. Confirm the user has sourced their Chameleon RC file.
   Example:
       source CHI-<project>-openrc.sh
4. Stop if these steps fail. Do not continue.

After this, the LLM may proceed.

====================================================
Part 1. Resource Discovery and Reservation Planning
====================================================

Relevant files:
1.2-resource-discovery.txt
1.3-reservations.txt

1. Discover hardware:
   Use the discovery workflow to find sites, clusters, nodes, and node types.
   Use 1.2-resource-discovery.txt when the user asks about availability.

2. Create or reuse a reservation:
   Use 1.3-reservations.txt to:
   - List leases
   - Show lease details
   - Create a new lease
   - Map lease_id to host_id
   - Confirm assigned hardware

Output:
reservation_id
Used later during launch.

====================================================
Part 2. Prepare Key Pair, Image, and Network
====================================================

Relevant files:
2.1-keys.txt
2.2-images.txt
2.3-networks.txt

The LLM must prepare three components before launching.

1. Key Pair:
   Needed for SSH.
   Later passed as:
       --key-name <KEY>

2. Image:
   List available images and pick one.
   Later used as:
       --image <IMAGE>

3. Network:
   List networks and select one.
   Later used as:
       --nic net-id=<NETWORK_UUID>

These three components do not depend on the reservation.

====================================================
Part 3. Launch a Bare-Metal Instance
====================================================

Relevant file:
2.4-bare-metal-instances.txt

Once the LLM has:
- reservation_id
- a key pair
- an image
- a network

Launch the instance:

    openstack server create \
      --image <IMAGE> \
      --flavor baremetal \
      --key-name <KEY> \
      --nic net-id=<NETWORK_UUID> \
      --hint reservation=<RESERVATION_ID> \
      <SERVER_NAME>

This creates a node with a private IP.

====================================================
Part 4. Add a Floating IP (Optional)
====================================================

Relevant file:
3.1-floating-ip.txt

If the user needs external SSH access:

1. Allocate a floating IP.
2. Attach it to the server.
3. Connect with:

       ssh ubuntu@<FLOATING_IP>

====================================================
Part 5. Run Checks and Troubleshoot
====================================================

Relevant file:
4.1-checks.txt

Use this to verify:
- The server is ACTIVE
- The reservation is correct
- The correct hardware node was assigned
- The floating IP is attached
- The user can SSH

Use this whenever the user reports a failure.

====================================================
Final Dependency Order
====================================================

1. Repo readiness and authentication (Part 0)
2. Resource discovery (Part 1)
3. Reservation creation (Part 1)
4. Key pair (Part 2)
5. Image selection (Part 2)
6. Network selection (Part 2)
7. Launch instance (Part 3)
8. Floating IP (Part 4)
9. Checks (Part 5)

This is the only valid workflow for launching bare-metal hardware through
OpenStack and Chameleon.

